export function getWindow() { return window; }
export function acceptType(accept, type, name) {
    if (!accept) {
        return true;
    }
    const defs = accept.split(',');
    let regx;
    let acceptRegString;
    for (let x = defs.length - 1; x >= 0; --x) {
        //Escapes dots in mimetype 
        acceptRegString = defs[x];
        //trim
        acceptRegString = acceptRegString.replace(/(^\s+|\s+$)/g, '');
        //Escapes stars in mimetype 
        acceptRegString = acceptRegString.replace(/\*/g, '.*');
        //let acceptReg = '^((' + acceptRegString
        //acceptReg = acceptReg.replace(/,/g,')|(') + '))$'
        //try by mime
        regx = new RegExp(acceptRegString, 'gi');
        if (type.search(regx) >= 0) {
            return true;
        }
        //try by ext
        if (acceptRegString.substring(0, 1) == '.') {
            acceptRegString = '\\' + acceptRegString; //.substring(1, acceptRegString.length-1)//remove dot at front
            regx = new RegExp(acceptRegString + '$', 'i');
            if ((name || type).search(regx) >= 0) {
                return true;
            }
        }
    }
    return false;
}
export function arrayBufferToBase64(buffer) {
    var binary = '';
    var bytes = new Uint8Array(buffer);
    var len = bytes.byteLength;
    for (var i = 0; i < len; i++) {
        binary += String.fromCharCode(bytes[i]);
    }
    return window.btoa(binary);
}
export function dataUrltoBlob(dataurl, name, origSize) {
    var arr = dataurl.split(',');
    var mimeMatch = arr[0].match(/:(.*?);/);
    var mime = mimeMatch ? mimeMatch[1] : 'text/plain';
    var bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
    while (n--) {
        u8arr[n] = bstr.charCodeAt(n);
    }
    var blob = new window.Blob([u8arr], { type: mime });
    blob["name"] = name;
    blob["$ngfOrigSize"] = origSize;
    return blob;
}
export function applyTransform(ctx, orientation, width, height) {
    switch (orientation) {
        case 2:
            return ctx.transform(-1, 0, 0, 1, width, 0);
        case 3:
            return ctx.transform(-1, 0, 0, -1, width, height);
        case 4:
            return ctx.transform(1, 0, 0, -1, 0, height);
        case 5:
            return ctx.transform(0, 1, 1, 0, 0, 0);
        case 6:
            return ctx.transform(0, 1, -1, 0, height, 0);
        case 7:
            return ctx.transform(0, -1, -1, 0, height, width);
        case 8:
            return ctx.transform(0, -1, 1, 0, 0, width);
    }
}
export function fixFileOrientationByMeta(file, result) {
    return dataUrl(file, true)
        .then(url => {
        var canvas = document.createElement('canvas');
        var img = document.createElement('img');
        return new Promise(function (res, rej) {
            img.onload = function () {
                try {
                    canvas.width = result.orientation > 4 ? img.height : img.width;
                    canvas.height = result.orientation > 4 ? img.width : img.height;
                    var ctx = canvas.getContext('2d');
                    applyTransform(ctx, result.orientation, img.width, img.height);
                    ctx.drawImage(img, 0, 0);
                    var dataUrl = canvas.toDataURL(file.type || 'image/WebP', 0.934);
                    const base = arrayBufferToBase64(result.fixedArrayBuffer);
                    dataUrl = restoreExif(base, dataUrl);
                    var blob = dataUrltoBlob(dataUrl, file.name);
                    const newFile = blobToFile(blob, file.name);
                    res(newFile);
                }
                catch (e) {
                    rej(e);
                }
            };
            img.onerror = rej;
            img.src = url;
        });
    });
}
export function applyExifRotation(file) {
    if (file.type.indexOf('image/jpeg') !== 0) {
        return Promise.resolve(file);
    }
    return readOrientation(file)
        .then((result) => {
        if (result.orientation < 2 || result.orientation > 8) {
            return file;
        }
        return fixFileOrientationByMeta(file, result);
    });
}
export function readOrientation(file) {
    return new Promise((res, rej) => {
        var reader = new FileReader();
        var slicedFile = file.slice ? file.slice(0, 64 * 1024) : file;
        reader.readAsArrayBuffer(slicedFile);
        reader.onerror = rej;
        reader.onload = function (e) {
            var result = { orientation: 1 };
            var view = new DataView(this.result);
            if (view.getUint16(0, false) !== 0xFFD8)
                return res(result);
            var length = view.byteLength, offset = 2;
            while (offset < length) {
                var marker = view.getUint16(offset, false);
                offset += 2;
                if (marker === 0xFFE1) {
                    if (view.getUint32(offset += 2, false) !== 0x45786966)
                        return res(result);
                    var little = view.getUint16(offset += 6, false) === 0x4949;
                    offset += view.getUint32(offset + 4, little);
                    var tags = view.getUint16(offset, little);
                    offset += 2;
                    for (var i = 0; i < tags; i++)
                        if (view.getUint16(offset + (i * 12), little) === 0x0112) {
                            var orientation = view.getUint16(offset + (i * 12) + 8, little);
                            if (orientation >= 2 && orientation <= 8) {
                                view.setUint16(offset + (i * 12) + 8, 1, little);
                                result.fixedArrayBuffer = e.target.result;
                            }
                            result.orientation = orientation;
                            return res(result);
                        }
                }
                else if ((marker & 0xFF00) !== 0xFF00)
                    break;
                else
                    offset += view.getUint16(offset, false);
            }
            return res(result);
        };
    });
}
/** converts file-input file into base64 dataUri */
export function dataUrl(file, disallowObjectUrl) {
    if (!file)
        return Promise.resolve(file);
    if ((disallowObjectUrl && file.$ngfDataUrl != null) || (!disallowObjectUrl && file.$ngfBlobUrl != null)) {
        return Promise.resolve(disallowObjectUrl ? file.$ngfDataUrl : file.$ngfBlobUrl);
    }
    var p = disallowObjectUrl ? file.$$ngfDataUrlPromise : file.$$ngfBlobUrlPromise;
    if (p)
        return p;
    const win = getWindow();
    let deferred;
    if (win.FileReader && file &&
        (!win.FileAPI || navigator.userAgent.indexOf('MSIE 8') === -1 || file.size < 20000) &&
        (!win.FileAPI || navigator.userAgent.indexOf('MSIE 9') === -1 || file.size < 4000000)) {
        //prefer URL.createObjectURL for handling refrences to files of all sizes
        //since it doesnÂ´t build a large string in memory
        var URL = win.URL || win.webkitURL;
        if (FileReader) {
            deferred = new Promise((res, rej) => {
                var fileReader = new FileReader();
                fileReader.onload = function (event) {
                    file.$ngfDataUrl = event.target.result;
                    delete file.$ngfDataUrl;
                    res(event.target.result);
                };
                fileReader.onerror = function (e) {
                    file.$ngfDataUrl = '';
                    rej(e);
                };
                fileReader.readAsDataURL(file);
            });
        }
        else {
            var url;
            try {
                url = URL.createObjectURL(file);
            }
            catch (e) {
                return Promise.reject(e);
            }
            deferred = Promise.resolve(url);
            file.$ngfBlobUrl = url;
        }
    }
    else {
        file[disallowObjectUrl ? '$ngfDataUrl' : '$ngfBlobUrl'] = '';
        return Promise.reject(new Error('Browser does not support window.FileReader, window.FileReader, or window.FileAPI')); //deferred.reject();
    }
    if (disallowObjectUrl) {
        p = file.$$ngfDataUrlPromise = deferred;
    }
    else {
        p = file.$$ngfBlobUrlPromise = deferred;
    }
    p = p.then((x) => {
        delete file[disallowObjectUrl ? '$$ngfDataUrlPromise' : '$$ngfBlobUrlPromise'];
        return x;
    });
    return p;
}
export function restoreExif(orig, resized) {
    var ExifRestorer = {
        KEY_STR: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='
    };
    ExifRestorer.encode64 = function (input) {
        var output = '', chr1, chr2, chr3 = '', enc1, enc2, enc3, enc4 = '', i = 0;
        do {
            chr1 = input[i++];
            chr2 = input[i++];
            chr3 = input[i++];
            enc1 = chr1 >> 2;
            enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
            enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
            enc4 = chr3 & 63;
            if (isNaN(chr2)) {
                enc3 = enc4 = 64;
            }
            else if (isNaN(chr3)) {
                enc4 = 64;
            }
            output = output +
                this.KEY_STR.charAt(enc1) +
                this.KEY_STR.charAt(enc2) +
                this.KEY_STR.charAt(enc3) +
                this.KEY_STR.charAt(enc4);
            chr1 = chr2 = chr3 = '';
            enc1 = enc2 = enc3 = enc4 = '';
        } while (i < input.length);
        return output;
    };
    ExifRestorer.restore = function (origFileBase64, resizedFileBase64) {
        if (origFileBase64.match('data:image/jpeg;base64,')) {
            origFileBase64 = origFileBase64.replace('data:image/jpeg;base64,', '');
        }
        var rawImage = this.decode64(origFileBase64);
        var segments = this.slice2Segments(rawImage);
        var image = this.exifManipulation(resizedFileBase64, segments);
        return 'data:image/jpeg;base64,' + this.encode64(image);
    };
    ExifRestorer.exifManipulation = function (resizedFileBase64, segments) {
        var exifArray = this.getExifArray(segments), newImageArray = this.insertExif(resizedFileBase64, exifArray);
        return new Uint8Array(newImageArray);
    };
    ExifRestorer.getExifArray = function (segments) {
        var seg;
        for (var x = 0; x < segments.length; x++) {
            seg = segments[x];
            if (seg[0] === 255 && seg[1] === 225) //(ff e1)
             {
                return seg;
            }
        }
        return [];
    };
    ExifRestorer.insertExif = function (resizedFileBase64, exifArray) {
        var imageData = resizedFileBase64.replace('data:image/jpeg;base64,', ''), buf = this.decode64(imageData), separatePoint = buf.indexOf(255, 3), mae = buf.slice(0, separatePoint), ato = buf.slice(separatePoint), array = mae;
        array = array.concat(exifArray);
        array = array.concat(ato);
        return array;
    };
    ExifRestorer.slice2Segments = function (rawImageArray) {
        var head = 0, segments = [];
        while (1) {
            if (rawImageArray[head] === 255 && rawImageArray[head + 1] === 218) {
                break;
            }
            if (rawImageArray[head] === 255 && rawImageArray[head + 1] === 216) {
                head += 2;
            }
            else {
                var length = rawImageArray[head + 2] * 256 + rawImageArray[head + 3];
                var endPoint = head + length + 2;
                var seg = rawImageArray.slice(head, endPoint);
                segments.push(seg);
                head = endPoint;
            }
            if (head > rawImageArray.length) {
                break;
            }
        }
        return segments;
    };
    ExifRestorer.decode64 = function (input) {
        var chr1, chr2, chr3 = '', enc1, enc2, enc3, enc4 = '', i = 0, buf = [];
        // remove all characters that are not A-Z, a-z, 0-9, +, /, or =
        var base64test = /[^A-Za-z0-9\+\/\=]/g;
        if (base64test.exec(input)) {
            console.log('There were invalid base64 characters in the input text.');
        }
        input = input.replace(/[^A-Za-z0-9\+\/\=]/g, '');
        do {
            enc1 = this.KEY_STR.indexOf(input.charAt(i++));
            enc2 = this.KEY_STR.indexOf(input.charAt(i++));
            enc3 = this.KEY_STR.indexOf(input.charAt(i++));
            enc4 = this.KEY_STR.indexOf(input.charAt(i++));
            chr1 = (enc1 << 2) | (enc2 >> 4);
            chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
            chr3 = ((enc3 & 3) << 6) | enc4;
            buf.push(chr1);
            if (enc3 !== 64) {
                buf.push(chr2);
            }
            if (enc4 !== 64) {
                buf.push(chr3);
            }
            chr1 = chr2 = chr3 = '';
            enc1 = enc2 = enc3 = enc4 = '';
        } while (i < input.length);
        return buf;
    };
    return ExifRestorer.restore(orig, resized); //<= EXIF
}
;
function blobToFile(theBlob, fileName) {
    var b = theBlob;
    //A Blob() is almost a File() - it's just missing the two properties below which we will add
    b.lastModifiedDate = new Date();
    b.name = fileName;
    //Cast to a File() type
    return theBlob;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZVRvb2xzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2ZpbGUtdXBsb2FkL2ZpbGVUb29scy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxNQUFNLFVBQVUsU0FBUyxLQUFPLE9BQU8sTUFBTSxDQUFBLENBQUEsQ0FBQztBQUU5QyxNQUFNLFVBQVUsVUFBVSxDQUFDLE1BQWEsRUFBRSxJQUFXLEVBQUUsSUFBWTtJQUNqRSxJQUFJLENBQUMsTUFBTSxFQUFFO1FBQ1gsT0FBTyxJQUFJLENBQUE7S0FDWjtJQUVELE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDOUIsSUFBSSxJQUFXLENBQUE7SUFDZixJQUFJLGVBQXNCLENBQUE7SUFFMUIsS0FBSSxJQUFJLENBQUMsR0FBQyxJQUFJLENBQUMsTUFBTSxHQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFDO1FBQ25DLDJCQUEyQjtRQUMzQixlQUFlLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQ3pCLE1BQU07UUFDTixlQUFlLEdBQUcsZUFBZSxDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUMsRUFBRSxDQUFDLENBQUE7UUFDNUQsNEJBQTRCO1FBQzVCLGVBQWUsR0FBRyxlQUFlLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBQyxJQUFJLENBQUMsQ0FBQTtRQUNyRCx5Q0FBeUM7UUFDekMsbURBQW1EO1FBRW5ELGFBQWE7UUFDYixJQUFJLEdBQUcsSUFBSSxNQUFNLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQyxDQUFBO1FBQ3hDLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBRSxDQUFDLEVBQUU7WUFDeEIsT0FBTyxJQUFJLENBQUE7U0FDWjtRQUVELFlBQVk7UUFDWixJQUFJLGVBQWUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FB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O2dCQUNmLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDaEI7WUFDRCxJQUFJLElBQUksS0FBSyxFQUFFLEVBQUU7Z0JBQ2YsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUNoQjtZQUVELElBQUksR0FBRyxJQUFJLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQztZQUN4QixJQUFJLEdBQUcsSUFBSSxHQUFHLElBQUksR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO1NBRWhDLFFBQVEsQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUU7UUFFM0IsT0FBTyxHQUFHLENBQUM7SUFDYixDQUFDLENBQUM7SUFFRixPQUFPLFlBQVksQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUUsU0FBUztBQUN4RCxDQUFDO0FBQUEsQ0FBQztBQUVGLFNBQVMsVUFBVSxDQUFDLE9BQWEsRUFBRSxRQUFlO0lBQ2hELElBQUksQ0FBQyxHQUFRLE9BQU8sQ0FBQztJQUNyQiw0RkFBNEY7SUFDNUYsQ0FBQyxDQUFDLGdCQUFnQixHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7SUFDaEMsQ0FBQyxDQUFDLElBQUksR0FBRyxRQUFRLENBQUM7SUFFbEIsdUJBQXVCO0lBQ3ZCLE9BQWEsT0FBTyxDQUFDO0FBQ3ZCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZnVuY3Rpb24gZ2V0V2luZG93KCk6YW55e3JldHVybiB3aW5kb3d9XG5cbmV4cG9ydCBmdW5jdGlvbiBhY2NlcHRUeXBlKGFjY2VwdDpzdHJpbmcsIHR5cGU6c3RyaW5nLCBuYW1lPzpzdHJpbmcpOmJvb2xlYW4geyAgIFxuICBpZiggIWFjY2VwdCApe1xuICAgIHJldHVybiB0cnVlXG4gIH1cblxuICBjb25zdCBkZWZzID0gYWNjZXB0LnNwbGl0KCcsJylcbiAgbGV0IHJlZ3g6UmVnRXhwXG4gIGxldCBhY2NlcHRSZWdTdHJpbmc6c3RyaW5nXG5cbiAgZm9yKGxldCB4PWRlZnMubGVuZ3RoLTE7IHggPj0gMDsgLS14KXtcbiAgICAvL0VzY2FwZXMgZG90cyBpbiBtaW1ldHlwZSBcbiAgICBhY2NlcHRSZWdTdHJpbmcgPSBkZWZzW3hdXG4gICAgLy90cmltXG4gICAgYWNjZXB0UmVnU3RyaW5nID0gYWNjZXB0UmVnU3RyaW5nLnJlcGxhY2UoLyheXFxzK3xcXHMrJCkvZywnJylcbiAgICAvL0VzY2FwZXMgc3RhcnMgaW4gbWltZXR5cGUgXG4gICAgYWNjZXB0UmVnU3RyaW5nID0gYWNjZXB0UmVnU3RyaW5nLnJlcGxhY2UoL1xcKi9nLCcuKicpXG4gICAgLy9sZXQgYWNjZXB0UmVnID0gJ14oKCcgKyBhY2NlcHRSZWdTdHJpbmdcbiAgICAvL2FjY2VwdFJlZyA9IGFjY2VwdFJlZy5yZXBsYWNlKC8sL2csJyl8KCcpICsgJykpJCdcbiAgICBcbiAgICAvL3RyeSBieSBtaW1lXG4gICAgcmVneCA9IG5ldyBSZWdFeHAoYWNjZXB0UmVnU3RyaW5nLCAnZ2knKVxuICAgIGlmKCB0eXBlLnNlYXJjaChyZWd4KT49MCApe1xuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG5cbiAgICAvL3RyeSBieSBleHRcbiAgICBpZiggYWNjZXB0UmVnU3RyaW5nLnN1YnN0cmluZygwLCAxKT09Jy4nICl7ICAgICAgXG4gICAgICBhY2NlcHRSZWdTdHJpbmcgPSAnXFxcXCcrIGFjY2VwdFJlZ1N0cmluZy8vLnN1YnN0cmluZygxLCBhY2NlcHRSZWdTdHJpbmcubGVuZ3RoLTEpLy9yZW1vdmUgZG90IGF0IGZyb250XG4gICAgICByZWd4ID0gbmV3IFJlZ0V4cChhY2NlcHRSZWdTdHJpbmcrJyQnLCAnaScpXG4gICAgICBpZiggKG5hbWV8fHR5cGUpLnNlYXJjaChyZWd4KT49MCApe1xuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2Vcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJbnZhbGlkRmlsZUl0ZW17XG4gIGZpbGU6RmlsZVxuICB0eXBlOnN0cmluZ1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYXJyYXlCdWZmZXJUb0Jhc2U2NChidWZmZXI6YW55KSB7XG4gIHZhciBiaW5hcnkgPSAnJztcbiAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKTtcbiAgdmFyIGxlbiA9IGJ5dGVzLmJ5dGVMZW5ndGg7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICBiaW5hcnkgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShieXRlc1tpXSk7XG4gIH1cbiAgcmV0dXJuIHdpbmRvdy5idG9hKGJpbmFyeSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkYXRhVXJsdG9CbG9iKFxuICBkYXRhdXJsOnN0cmluZyxcbiAgbmFtZTpzdHJpbmcsXG4gIG9yaWdTaXplPzphbnlcbik6QmxvYntcbiAgdmFyIGFyciA9IGRhdGF1cmwuc3BsaXQoJywnKTtcbiAgdmFyIG1pbWVNYXRjaCA9IGFyclswXS5tYXRjaCgvOiguKj8pOy8pXG4gIHZhciBtaW1lOnN0cmluZyA9IG1pbWVNYXRjaCA/IG1pbWVNYXRjaFsxXSA6ICd0ZXh0L3BsYWluJ1xuICB2YXIgYnN0ciA9IGF0b2IoYXJyWzFdKSwgbiA9IGJzdHIubGVuZ3RoLCB1OGFyciA9IG5ldyBVaW50OEFycmF5KG4pO1xuICB3aGlsZSAobi0tKSB7XG4gICAgdThhcnJbbl0gPSBic3RyLmNoYXJDb2RlQXQobik7XG4gIH1cbiAgXG4gIHZhciBibG9iOiBhbnkgPSBuZXcgd2luZG93LkJsb2IoW3U4YXJyXSwge3R5cGU6IG1pbWV9KTtcbiAgYmxvYltcIm5hbWVcIl0gPSBuYW1lO1xuICBibG9iW1wiJG5nZk9yaWdTaXplXCJdID0gb3JpZ1NpemU7XG4gIHJldHVybiBibG9iO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIG9yaWVudGF0aW9uTWV0YXtcbiAgb3JpZW50YXRpb246IG51bWJlclxuICBmaXhlZEFycmF5QnVmZmVyPzphbnlbXVxufVxuXG5leHBvcnQgZnVuY3Rpb24gYXBwbHlUcmFuc2Zvcm0oXG4gIGN0eDpDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQsXG4gIG9yaWVudGF0aW9uOm51bWJlcixcbiAgd2lkdGg6bnVtYmVyLFxuICBoZWlnaHQ6bnVtYmVyXG4pIHtcbiAgc3dpdGNoIChvcmllbnRhdGlvbikge1xuICAgIGNhc2UgMjpcbiAgICAgIHJldHVybiBjdHgudHJhbnNmb3JtKC0xLCAwLCAwLCAxLCB3aWR0aCwgMCk7XG4gICAgY2FzZSAzOlxuICAgICAgcmV0dXJuIGN0eC50cmFuc2Zvcm0oLTEsIDAsIDAsIC0xLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICBjYXNlIDQ6XG4gICAgICByZXR1cm4gY3R4LnRyYW5zZm9ybSgxLCAwLCAwLCAtMSwgMCwgaGVpZ2h0KTtcbiAgICBjYXNlIDU6XG4gICAgICByZXR1cm4gY3R4LnRyYW5zZm9ybSgwLCAxLCAxLCAwLCAwLCAwKTtcbiAgICBjYXNlIDY6XG4gICAgICByZXR1cm4gY3R4LnRyYW5zZm9ybSgwLCAxLCAtMSwgMCwgaGVpZ2h0LCAwKTtcbiAgICBjYXNlIDc6XG4gICAgICByZXR1cm4gY3R4LnRyYW5zZm9ybSgwLCAtMSwgLTEsIDAsIGhlaWdodCwgd2lkdGgpO1xuICAgIGNhc2UgODpcbiAgICAgIHJldHVybiBjdHgudHJhbnNmb3JtKDAsIC0xLCAxLCAwLCAwLCB3aWR0aCk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZpeEZpbGVPcmllbnRhdGlvbkJ5TWV0YShcbiAgZmlsZTpGaWxlLCByZXN1bHQ6b3JpZW50YXRpb25NZXRhXG4pOlByb21pc2U8RmlsZT57XG4gIHJldHVybiBkYXRhVXJsKGZpbGUsIHRydWUpXG4gIC50aGVuKHVybD0+e1xuICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICB2YXIgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG5cbiAgICByZXR1cm4gPFByb21pc2U8RmlsZT4+bmV3IFByb21pc2UoZnVuY3Rpb24ocmVzLHJlail7XG4gICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNhbnZhcy53aWR0aCA9IHJlc3VsdC5vcmllbnRhdGlvbiA+IDQgPyBpbWcuaGVpZ2h0IDogaW1nLndpZHRoXG4gICAgICAgICAgY2FudmFzLmhlaWdodCA9IHJlc3VsdC5vcmllbnRhdGlvbiA+IDQgPyBpbWcud2lkdGggOiBpbWcuaGVpZ2h0XG4gICAgICAgICAgdmFyIGN0eCA9IDxDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ+Y2FudmFzLmdldENvbnRleHQoJzJkJylcbiAgICAgICAgICBhcHBseVRyYW5zZm9ybShjdHgsIHJlc3VsdC5vcmllbnRhdGlvbiwgaW1nLndpZHRoLCBpbWcuaGVpZ2h0KVxuICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwKTtcbiAgICAgICAgICB2YXIgZGF0YVVybCA9IGNhbnZhcy50b0RhdGFVUkwoZmlsZS50eXBlIHx8ICdpbWFnZS9XZWJQJywgMC45MzQpXG4gICAgICAgICAgY29uc3QgYmFzZSA9IGFycmF5QnVmZmVyVG9CYXNlNjQocmVzdWx0LmZpeGVkQXJyYXlCdWZmZXIpXG4gICAgICAgICAgZGF0YVVybCA9IHJlc3RvcmVFeGlmKGJhc2UsIGRhdGFVcmwpXG4gICAgICAgICAgdmFyIGJsb2IgPSBkYXRhVXJsdG9CbG9iKGRhdGFVcmwsIGZpbGUubmFtZSlcbiAgICAgICAgICBjb25zdCBuZXdGaWxlID0gYmxvYlRvRmlsZShibG9iLCBmaWxlLm5hbWUpO1xuICAgICAgICAgIHJlcyhuZXdGaWxlKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIHJlaihlKVxuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgaW1nLm9uZXJyb3IgPSByZWo7XG4gICAgICBpbWcuc3JjID0gdXJsOyAgICBcbiAgICB9KVxuICB9KVxufVxuXG5leHBvcnQgZnVuY3Rpb24gYXBwbHlFeGlmUm90YXRpb24oXG4gIGZpbGU6RmlsZVxuKTpQcm9taXNlPEZpbGU+e1xuICBpZiAoZmlsZS50eXBlLmluZGV4T2YoJ2ltYWdlL2pwZWcnKSAhPT0gMCkge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZmlsZSk7XG4gIH1cblxuICByZXR1cm4gcmVhZE9yaWVudGF0aW9uKGZpbGUpXG4gIC50aGVuKChyZXN1bHQ6b3JpZW50YXRpb25NZXRhKT0+e1xuICAgIGlmIChyZXN1bHQub3JpZW50YXRpb24gPCAyIHx8IHJlc3VsdC5vcmllbnRhdGlvbiA+IDgpIHtcbiAgICAgIHJldHVybiBmaWxlXG4gICAgfVxuICAgIFxuICAgIHJldHVybiBmaXhGaWxlT3JpZW50YXRpb25CeU1ldGEoZmlsZSxyZXN1bHQpXG4gIH0pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZWFkT3JpZW50YXRpb24oXG4gIGZpbGU6RmlsZVxuKTpQcm9taXNlPG9yaWVudGF0aW9uTWV0YT57XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzLHJlaik9PntcbiAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICB2YXIgc2xpY2VkRmlsZSA9IGZpbGUuc2xpY2UgPyBmaWxlLnNsaWNlKDAsIDY0ICogMTAyNCkgOiBmaWxlO1xuICAgIHJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihzbGljZWRGaWxlKTtcbiAgICByZWFkZXIub25lcnJvciA9IHJlalxuICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZTphbnkpIHtcbiAgICAgIHZhciByZXN1bHQ6b3JpZW50YXRpb25NZXRhID0ge29yaWVudGF0aW9uOiAxfTtcbiAgICAgIHZhciB2aWV3ID0gbmV3IERhdGFWaWV3KCA8QXJyYXlCdWZmZXI+dGhpcy5yZXN1bHQgKTtcbiAgICAgIGlmICh2aWV3LmdldFVpbnQxNigwLCBmYWxzZSkgIT09IDB4RkZEOCkgcmV0dXJuIHJlcyhyZXN1bHQpO1xuXG4gICAgICB2YXIgbGVuZ3RoID0gdmlldy5ieXRlTGVuZ3RoLFxuICAgICAgICBvZmZzZXQgPSAyO1xuICAgICAgd2hpbGUgKG9mZnNldCA8IGxlbmd0aCkge1xuICAgICAgICB2YXIgbWFya2VyID0gdmlldy5nZXRVaW50MTYob2Zmc2V0LCBmYWxzZSk7XG4gICAgICAgIG9mZnNldCArPSAyO1xuICAgICAgICBpZiAobWFya2VyID09PSAweEZGRTEpIHtcbiAgICAgICAgICBpZiAodmlldy5nZXRVaW50MzIob2Zmc2V0ICs9IDIsIGZhbHNlKSAhPT0gMHg0NTc4Njk2NikgcmV0dXJuIHJlcyhyZXN1bHQpO1xuXG4gICAgICAgICAgdmFyIGxpdHRsZSA9IHZpZXcuZ2V0VWludDE2KG9mZnNldCArPSA2LCBmYWxzZSkgPT09IDB4NDk0OTtcbiAgICAgICAgICBvZmZzZXQgKz0gdmlldy5nZXRVaW50MzIob2Zmc2V0ICsgNCwgbGl0dGxlKTtcbiAgICAgICAgICB2YXIgdGFncyA9IHZpZXcuZ2V0VWludDE2KG9mZnNldCwgbGl0dGxlKTtcbiAgICAgICAgICBvZmZzZXQgKz0gMjtcbiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRhZ3M7IGkrKylcbiAgICAgICAgICAgIGlmICh2aWV3LmdldFVpbnQxNihvZmZzZXQgKyAoaSAqIDEyKSwgbGl0dGxlKSA9PT0gMHgwMTEyKSB7XG4gICAgICAgICAgICAgIHZhciBvcmllbnRhdGlvbiA9IHZpZXcuZ2V0VWludDE2KG9mZnNldCArIChpICogMTIpICsgOCwgbGl0dGxlKTtcbiAgICAgICAgICAgICAgaWYgKG9yaWVudGF0aW9uID49IDIgJiYgb3JpZW50YXRpb24gPD0gOCkge1xuICAgICAgICAgICAgICAgIHZpZXcuc2V0VWludDE2KG9mZnNldCArIChpICogMTIpICsgOCwgMSwgbGl0dGxlKTtcbiAgICAgICAgICAgICAgICByZXN1bHQuZml4ZWRBcnJheUJ1ZmZlciA9IGUudGFyZ2V0LnJlc3VsdDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXN1bHQub3JpZW50YXRpb24gPSBvcmllbnRhdGlvbjtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlcyhyZXN1bHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKChtYXJrZXIgJiAweEZGMDApICE9PSAweEZGMDApIGJyZWFrO1xuICAgICAgICBlbHNlIG9mZnNldCArPSB2aWV3LmdldFVpbnQxNihvZmZzZXQsIGZhbHNlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXMocmVzdWx0KTtcbiAgICB9O1xuICB9KVxufVxuXG4vKiogY29udmVydHMgZmlsZS1pbnB1dCBmaWxlIGludG8gYmFzZTY0IGRhdGFVcmkgKi9cbmV4cG9ydCBmdW5jdGlvbiBkYXRhVXJsKFxuICBmaWxlOmFueSxcbiAgZGlzYWxsb3dPYmplY3RVcmw/OmFueVxuKTpQcm9taXNlPHN0cmluZz57XG4gIGlmICghZmlsZSkgcmV0dXJuIFByb21pc2UucmVzb2x2ZShmaWxlKVxuICBcbiAgaWYgKChkaXNhbGxvd09iamVjdFVybCAmJiBmaWxlLiRuZ2ZEYXRhVXJsICE9IG51bGwpIHx8ICghZGlzYWxsb3dPYmplY3RVcmwgJiYgZmlsZS4kbmdmQmxvYlVybCAhPSBudWxsKSkge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoIGRpc2FsbG93T2JqZWN0VXJsID8gZmlsZS4kbmdmRGF0YVVybCA6IGZpbGUuJG5nZkJsb2JVcmwgKVxuICB9XG5cbiAgdmFyIHAgPSBkaXNhbGxvd09iamVjdFVybCA/IGZpbGUuJCRuZ2ZEYXRhVXJsUHJvbWlzZSA6IGZpbGUuJCRuZ2ZCbG9iVXJsUHJvbWlzZTtcbiAgaWYgKHApIHJldHVybiBwO1xuXG4gIGNvbnN0IHdpbiA9IGdldFdpbmRvdygpXG4gIGxldCBkZWZlcnJlZDpQcm9taXNlPHN0cmluZz5cbiAgaWYgKHdpbi5GaWxlUmVhZGVyICYmIGZpbGUgJiZcbiAgICAoIXdpbi5GaWxlQVBJIHx8IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignTVNJRSA4JykgPT09IC0xIHx8IGZpbGUuc2l6ZSA8IDIwMDAwKSAmJlxuICAgICghd2luLkZpbGVBUEkgfHwgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdNU0lFIDknKSA9PT0gLTEgfHwgZmlsZS5zaXplIDwgNDAwMDAwMCkpIHtcbiAgICAvL3ByZWZlciBVUkwuY3JlYXRlT2JqZWN0VVJMIGZvciBoYW5kbGluZyByZWZyZW5jZXMgdG8gZmlsZXMgb2YgYWxsIHNpemVzXG4gICAgLy9zaW5jZSBpdCBkb2VzbsK0dCBidWlsZCBhIGxhcmdlIHN0cmluZyBpbiBtZW1vcnlcbiAgICB2YXIgVVJMID0gd2luLlVSTCB8fCB3aW4ud2Via2l0VVJMO1xuICAgIGlmIChGaWxlUmVhZGVyKSB7XG4gICAgICBkZWZlcnJlZCA9IG5ldyBQcm9taXNlKChyZXMscmVqKT0+e1xuICAgICAgICB2YXIgZmlsZVJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgICAgIGZpbGVSZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGV2ZW50OmFueSkge1xuICAgICAgICAgIGZpbGUuJG5nZkRhdGFVcmwgPSBldmVudC50YXJnZXQucmVzdWx0O1xuICAgICAgICAgIGRlbGV0ZSBmaWxlLiRuZ2ZEYXRhVXJsO1xuICAgICAgICAgIHJlcyggZXZlbnQudGFyZ2V0LnJlc3VsdCApXG4gICAgICAgIH07XG4gICAgICAgIGZpbGVSZWFkZXIub25lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgZmlsZS4kbmdmRGF0YVVybCA9ICcnO1xuICAgICAgICAgIHJlaihlKVxuICAgICAgICB9O1xuICAgICAgICBmaWxlUmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XG4gICAgICB9KVxuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgdXJsOmFueTtcbiAgICAgIHRyeSB7XG4gICAgICAgIHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoZmlsZSk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgZGVmZXJyZWQgPSBQcm9taXNlLnJlc29sdmUoIHVybCApXG4gICAgICBmaWxlLiRuZ2ZCbG9iVXJsID0gdXJsO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBmaWxlW2Rpc2FsbG93T2JqZWN0VXJsID8gJyRuZ2ZEYXRhVXJsJyA6ICckbmdmQmxvYlVybCddID0gJyc7XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KCBuZXcgRXJyb3IoJ0Jyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCB3aW5kb3cuRmlsZVJlYWRlciwgd2luZG93LkZpbGVSZWFkZXIsIG9yIHdpbmRvdy5GaWxlQVBJJykgKS8vZGVmZXJyZWQucmVqZWN0KCk7XG4gIH1cblxuICBpZiAoZGlzYWxsb3dPYmplY3RVcmwpIHtcbiAgICBwID0gZmlsZS4kJG5nZkRhdGFVcmxQcm9taXNlID0gZGVmZXJyZWQ7XG4gIH0gZWxzZSB7XG4gICAgcCA9IGZpbGUuJCRuZ2ZCbG9iVXJsUHJvbWlzZSA9IGRlZmVycmVkO1xuICB9XG5cbiAgcCA9IHAudGhlbigoeDphbnkpPT57XG4gICAgZGVsZXRlIGZpbGVbZGlzYWxsb3dPYmplY3RVcmwgPyAnJCRuZ2ZEYXRhVXJsUHJvbWlzZScgOiAnJCRuZ2ZCbG9iVXJsUHJvbWlzZSddO1xuICAgIHJldHVybiB4XG4gIH0pXG5cbiAgcmV0dXJuIHA7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZXN0b3JlRXhpZihvcmlnOmFueSwgcmVzaXplZDphbnkpIHtcbiAgdmFyIEV4aWZSZXN0b3JlcjphbnkgPSB7XG4gICAgS0VZX1NUUjonQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLz0nXG4gIH1cblxuICBFeGlmUmVzdG9yZXIuZW5jb2RlNjQgPSBmdW5jdGlvbiAoaW5wdXQ6YW55KSB7XG4gICAgdmFyIG91dHB1dCA9ICcnLFxuICAgICAgY2hyMSwgY2hyMiwgY2hyMzphbnkgPSAnJyxcbiAgICAgIGVuYzEsIGVuYzIsIGVuYzMsIGVuYzQ6YW55ID0gJycsXG4gICAgICBpID0gMDtcblxuICAgIGRvIHtcbiAgICAgIGNocjEgPSBpbnB1dFtpKytdO1xuICAgICAgY2hyMiA9IGlucHV0W2krK107XG4gICAgICBjaHIzID0gaW5wdXRbaSsrXTtcblxuICAgICAgZW5jMSA9IGNocjEgPj4gMjtcbiAgICAgIGVuYzIgPSAoKGNocjEgJiAzKSA8PCA0KSB8IChjaHIyID4+IDQpO1xuICAgICAgZW5jMyA9ICgoY2hyMiAmIDE1KSA8PCAyKSB8IChjaHIzID4+IDYpO1xuICAgICAgZW5jNCA9IGNocjMgJiA2MztcblxuICAgICAgaWYgKGlzTmFOKGNocjIpKSB7XG4gICAgICAgIGVuYzMgPSBlbmM0ID0gNjQ7XG4gICAgICB9IGVsc2UgaWYgKGlzTmFOKGNocjMpKSB7XG4gICAgICAgIGVuYzQgPSA2NDtcbiAgICAgIH1cblxuICAgICAgb3V0cHV0ID0gb3V0cHV0ICtcbiAgICAgICAgdGhpcy5LRVlfU1RSLmNoYXJBdChlbmMxKSArXG4gICAgICAgIHRoaXMuS0VZX1NUUi5jaGFyQXQoZW5jMikgK1xuICAgICAgICB0aGlzLktFWV9TVFIuY2hhckF0KGVuYzMpICtcbiAgICAgICAgdGhpcy5LRVlfU1RSLmNoYXJBdChlbmM0KTtcbiAgICAgIGNocjEgPSBjaHIyID0gY2hyMyA9ICcnO1xuICAgICAgZW5jMSA9IGVuYzIgPSBlbmMzID0gZW5jNCA9ICcnO1xuICAgIH0gd2hpbGUgKGkgPCBpbnB1dC5sZW5ndGgpO1xuXG4gICAgcmV0dXJuIG91dHB1dDtcbiAgfTtcblxuICBFeGlmUmVzdG9yZXIucmVzdG9yZSA9IGZ1bmN0aW9uIChvcmlnRmlsZUJhc2U2NDphbnksIHJlc2l6ZWRGaWxlQmFzZTY0OmFueSkge1xuICAgIGlmIChvcmlnRmlsZUJhc2U2NC5tYXRjaCgnZGF0YTppbWFnZS9qcGVnO2Jhc2U2NCwnKSkge1xuICAgICAgb3JpZ0ZpbGVCYXNlNjQgPSBvcmlnRmlsZUJhc2U2NC5yZXBsYWNlKCdkYXRhOmltYWdlL2pwZWc7YmFzZTY0LCcsICcnKTtcbiAgICB9XG5cbiAgICB2YXIgcmF3SW1hZ2U6bnVtYmVyW10gPSB0aGlzLmRlY29kZTY0KG9yaWdGaWxlQmFzZTY0KTtcbiAgICB2YXIgc2VnbWVudHMgPSB0aGlzLnNsaWNlMlNlZ21lbnRzKHJhd0ltYWdlKTtcblxuICAgIHZhciBpbWFnZSA9IHRoaXMuZXhpZk1hbmlwdWxhdGlvbihyZXNpemVkRmlsZUJhc2U2NCwgc2VnbWVudHMpO1xuXG4gICAgcmV0dXJuICdkYXRhOmltYWdlL2pwZWc7YmFzZTY0LCcgKyB0aGlzLmVuY29kZTY0KGltYWdlKTtcbiAgfTtcblxuXG4gIEV4aWZSZXN0b3Jlci5leGlmTWFuaXB1bGF0aW9uID0gZnVuY3Rpb24gKHJlc2l6ZWRGaWxlQmFzZTY0OmFueSwgc2VnbWVudHM6YW55KSB7XG4gICAgdmFyIGV4aWZBcnJheSA9IHRoaXMuZ2V0RXhpZkFycmF5KHNlZ21lbnRzKSxcbiAgICAgIG5ld0ltYWdlQXJyYXkgPSB0aGlzLmluc2VydEV4aWYocmVzaXplZEZpbGVCYXNlNjQsIGV4aWZBcnJheSk7XG4gICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KG5ld0ltYWdlQXJyYXkpO1xuICB9O1xuXG4gIEV4aWZSZXN0b3Jlci5nZXRFeGlmQXJyYXkgPSBmdW5jdGlvbiAoc2VnbWVudHM6bnVtYmVyW11bXSkge1xuICAgIHZhciBzZWc7XG4gICAgZm9yICh2YXIgeCA9IDA7IHggPCBzZWdtZW50cy5sZW5ndGg7IHgrKykge1xuICAgICAgc2VnID0gc2VnbWVudHNbeF07XG4gICAgICBpZiAoc2VnWzBdID09PSAyNTUgJiYgc2VnWzFdID09PSAyMjUpIC8vKGZmIGUxKVxuICAgICAge1xuICAgICAgICByZXR1cm4gc2VnO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gW107XG4gIH07XG5cblxuICBFeGlmUmVzdG9yZXIuaW5zZXJ0RXhpZiA9IGZ1bmN0aW9uIChyZXNpemVkRmlsZUJhc2U2NDphbnksIGV4aWZBcnJheTphbnkpIHtcbiAgICB2YXIgaW1hZ2VEYXRhID0gcmVzaXplZEZpbGVCYXNlNjQucmVwbGFjZSgnZGF0YTppbWFnZS9qcGVnO2Jhc2U2NCwnLCAnJyksXG4gICAgICBidWYgPSB0aGlzLmRlY29kZTY0KGltYWdlRGF0YSksXG4gICAgICBzZXBhcmF0ZVBvaW50ID0gYnVmLmluZGV4T2YoMjU1LCAzKSxcbiAgICAgIG1hZSA9IGJ1Zi5zbGljZSgwLCBzZXBhcmF0ZVBvaW50KSxcbiAgICAgIGF0byA9IGJ1Zi5zbGljZShzZXBhcmF0ZVBvaW50KSxcbiAgICAgIGFycmF5ID0gbWFlO1xuXG4gICAgYXJyYXkgPSBhcnJheS5jb25jYXQoZXhpZkFycmF5KTtcbiAgICBhcnJheSA9IGFycmF5LmNvbmNhdChhdG8pO1xuICAgIHJldHVybiBhcnJheTtcbiAgfTtcblxuXG4gIEV4aWZSZXN0b3Jlci5zbGljZTJTZWdtZW50cyA9IGZ1bmN0aW9uKFxuICAgIHJhd0ltYWdlQXJyYXk6bnVtYmVyW11cbiAgKSB7XG4gICAgdmFyIGhlYWQ6bnVtYmVyID0gMCxcbiAgICAgIHNlZ21lbnRzOm51bWJlcltdW10gPSBbXTtcblxuICAgIHdoaWxlICgxKSB7XG4gICAgICBpZiAocmF3SW1hZ2VBcnJheVtoZWFkXSA9PT0gMjU1ICYmIHJhd0ltYWdlQXJyYXlbaGVhZCArIDFdID09PSAyMTgpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBpZiAocmF3SW1hZ2VBcnJheVtoZWFkXSA9PT0gMjU1ICYmIHJhd0ltYWdlQXJyYXlbaGVhZCArIDFdID09PSAyMTYpIHtcbiAgICAgICAgaGVhZCArPSAyO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHZhciBsZW5ndGggPSByYXdJbWFnZUFycmF5W2hlYWQgKyAyXSAqIDI1NiArIHJhd0ltYWdlQXJyYXlbaGVhZCArIDNdXG4gICAgICAgIHZhciBlbmRQb2ludCA9IGhlYWQgKyBsZW5ndGggKyAyXG4gICAgICAgIHZhciBzZWc6bnVtYmVyW10gPSByYXdJbWFnZUFycmF5LnNsaWNlKGhlYWQsIGVuZFBvaW50KVxuICAgICAgICBzZWdtZW50cy5wdXNoKHNlZyk7XG4gICAgICAgIGhlYWQgPSBlbmRQb2ludDtcbiAgICAgIH1cbiAgICAgIGlmIChoZWFkID4gcmF3SW1hZ2VBcnJheS5sZW5ndGgpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHNlZ21lbnRzO1xuICB9O1xuXG5cbiAgRXhpZlJlc3RvcmVyLmRlY29kZTY0ID0gZnVuY3Rpb24gKFxuICAgIGlucHV0OmFueVxuICApOm51bWJlcltde1xuICAgIHZhciBjaHIxLCBjaHIyLCBjaHIzOmFueSA9ICcnLFxuICAgICAgZW5jMSwgZW5jMiwgZW5jMywgZW5jNDphbnkgPSAnJyxcbiAgICAgIGkgPSAwLFxuICAgICAgYnVmOm51bWJlcltdID0gW107XG5cbiAgICAvLyByZW1vdmUgYWxsIGNoYXJhY3RlcnMgdGhhdCBhcmUgbm90IEEtWiwgYS16LCAwLTksICssIC8sIG9yID1cbiAgICB2YXIgYmFzZTY0dGVzdCA9IC9bXkEtWmEtejAtOVxcK1xcL1xcPV0vZztcbiAgICBpZiAoYmFzZTY0dGVzdC5leGVjKGlucHV0KSkge1xuICAgICAgY29uc29sZS5sb2coJ1RoZXJlIHdlcmUgaW52YWxpZCBiYXNlNjQgY2hhcmFjdGVycyBpbiB0aGUgaW5wdXQgdGV4dC4nKTtcbiAgICB9XG4gICAgaW5wdXQgPSBpbnB1dC5yZXBsYWNlKC9bXkEtWmEtejAtOVxcK1xcL1xcPV0vZywgJycpO1xuXG4gICAgZG8ge1xuICAgICAgZW5jMSA9IHRoaXMuS0VZX1NUUi5pbmRleE9mKGlucHV0LmNoYXJBdChpKyspKTtcbiAgICAgIGVuYzIgPSB0aGlzLktFWV9TVFIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7XG4gICAgICBlbmMzID0gdGhpcy5LRVlfU1RSLmluZGV4T2YoaW5wdXQuY2hhckF0KGkrKykpO1xuICAgICAgZW5jNCA9IHRoaXMuS0VZX1NUUi5pbmRleE9mKGlucHV0LmNoYXJBdChpKyspKTtcblxuICAgICAgY2hyMSA9IChlbmMxIDw8IDIpIHwgKGVuYzIgPj4gNCk7XG4gICAgICBjaHIyID0gKChlbmMyICYgMTUpIDw8IDQpIHwgKGVuYzMgPj4gMik7XG4gICAgICBjaHIzID0gKChlbmMzICYgMykgPDwgNikgfCBlbmM0O1xuXG4gICAgICBidWYucHVzaChjaHIxKTtcblxuICAgICAgaWYgKGVuYzMgIT09IDY0KSB7XG4gICAgICAgIGJ1Zi5wdXNoKGNocjIpO1xuICAgICAgfVxuICAgICAgaWYgKGVuYzQgIT09IDY0KSB7XG4gICAgICAgIGJ1Zi5wdXNoKGNocjMpO1xuICAgICAgfVxuXG4gICAgICBjaHIxID0gY2hyMiA9IGNocjMgPSAnJztcbiAgICAgIGVuYzEgPSBlbmMyID0gZW5jMyA9IGVuYzQgPSAnJztcblxuICAgIH0gd2hpbGUgKGkgPCBpbnB1dC5sZW5ndGgpO1xuXG4gICAgcmV0dXJuIGJ1ZjtcbiAgfTtcblxuICByZXR1cm4gRXhpZlJlc3RvcmVyLnJlc3RvcmUob3JpZywgcmVzaXplZCk7ICAvLzw9IEVYSUZcbn07XG5cbmZ1bmN0aW9uIGJsb2JUb0ZpbGUodGhlQmxvYjogQmxvYiwgZmlsZU5hbWU6c3RyaW5nKTogRmlsZSB7XG4gIHZhciBiOiBhbnkgPSB0aGVCbG9iO1xuICAvL0EgQmxvYigpIGlzIGFsbW9zdCBhIEZpbGUoKSAtIGl0J3MganVzdCBtaXNzaW5nIHRoZSB0d28gcHJvcGVydGllcyBiZWxvdyB3aGljaCB3ZSB3aWxsIGFkZFxuICBiLmxhc3RNb2RpZmllZERhdGUgPSBuZXcgRGF0ZSgpO1xuICBiLm5hbWUgPSBmaWxlTmFtZTtcblxuICAvL0Nhc3QgdG8gYSBGaWxlKCkgdHlwZVxuICByZXR1cm4gPEZpbGU+dGhlQmxvYjtcbn1cbiJdfQ==